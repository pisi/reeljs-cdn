/*
 Copyright (c) 2009-2012 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 jQuery Reel
 http://jquery.vostrel.cz/reel
 Version: 1.1.3-devel
 Updated: 2012-02-15

 Requires jQuery 1.5 or higher
*/
jQuery.reel||function(m,Ob,Ba,n){function Pb(g){return o.instances.push(g[0])&&g}function Qb(g){return(o.instances=o.instances.not(Ca(g.attr(ga))))&&g}function Y(g){return o.instances.length?o.instances.first().data(g):null}function Rb(g){return"data:image/gif;base64,R0lGODlh"+g}function S(g){return"<"+g+"/>"}function s(g){return"."+(g||"")}function Da(g){return o.cdn+g}function Ea(g){return"url("+g+")"}function na(g,k,r){return nb(g,Wa(k,r))}function Sb(g){function k(){m.fn[this]||(m.fn[this]=function(){return this})}
m.each(g,k)}function Xa(g,k){return M(g)*(k?-1:1)}function Fa(g){return Ga?g.touch||g.originalEvent.touches[0]:g}function z(g){return g===n?0:typeof g==ob?g:g+"px"}function Ca(g){return"#"+g}function pb(g){try{console.warn("Deprecation - Please consult https://github.com/pisi/Reel/wiki/Deprecations")}catch(k){}return g}if(+m().jquery.replace(s(),"").substr(0,2)<15)throw"VersionError: far too old jQuery for running Reel";var o=m.reel={version:"1.1.3-devel",def:{area:n,brake:0.23,clickfree:false,cw:false,
delay:-1,directional:false,draggable:true,footage:6,entry:n,frame:1,frames:36,graph:n,hint:"",horizontal:true,image:n,images:[],indicator:0,inversed:false,klass:"",laziness:6,loops:true,monitor:n,opening:0,orbital:0,path:"",preloader:2,rebound:0.5,revolution:n,row:1,rows:0,spacing:0,speed:0,step:n,steps:n,stitched:0,suffix:"-reel",tempo:36,timeout:2,throwable:true,vertical:false,wheelable:true,annotations:n,attr:{},cursor:n,preload:"fidelity",scrollable:true,steppable:true,sequence:"",velocity:0},
fn:{reel:function(){var g=arguments,k=m(this),r=k.data(),u=g[0],v=g[1];if(g.length==2){if(v!==n){try{v=o.normal[u](v,r)}catch(I){}if(r[u]!==v)k.trigger(u+"Change",[n,r[u]=v])}return k.trigger("store",[u,v])}else if(typeof u=="string"){v=r[u];k.trigger("recall",[u,v]);return v}else{var a=m.extend({},o.def,u);g=function(j){var e=[];j.filter(Ya).each(function(){var b=m(this),w=a.images.length&&a.images||a.sequence||a.image||a.attr.src||b.attr("src"),D=oa(a.attr.width||b.css(Za)),A=oa(a.attr.height||
b.css(qb));w&&w!=J&&D&&A&&e.push(b)});j.filter(s(y)).each(function(){e.push(m(this).unreel())});return m(e)}(this);var N=[];a.step&&(a.frame=a.step);a.steps&&(a.frames=a.steps);g.each(function(){var j=m(this),e=function(d,c){return j.reel(d,c)&&c},b=function(d){return j.reel(d)},w={setup:function(){if(!j.hasClass(y)){e(Ha,a);var d=j.attr(a.attr).attr("src"),c=e(ga,j.attr(ga)||j.attr(ga,y+"-"+ +new Date).attr(ga)),f=j.attr(pa),h=m.extend({},j.data()),i=o.re.sequence.exec(a.sequence);i=e(Z,i?o.sequence(i,
a,b):a.images);var l=a.stitched,q=a.loops,p={x:oa(j.css(Za)||a.attr.width),y:oa(j.css(qb)||a.attr.height)},ha=e(F,a.orbital&&a.footage||a.rows<=1&&i.length||a.frames),O=l?1:qa(ha/a.footage);c=Ca(c+a.suffix);var $=j[0].className||J,K=m(S(ra),{id:c.substr(1),"class":$+B+Tb+B+rb+"0"});K=j.wrap(K.addClass(a.klass)).attr({"class":y});N.push(Pb(K)[0]);K=K.parent().bind(w.instance);e($a,i.length?J:a.image||d.replace(o.re.image,"$1"+a.suffix+".$2"));e(sb,[]);e(tb,a.spacing);e(ab,O);e(G,p);e(Ia,a.revolution||
l/2||p.x*2);e(Ja,1/(ha-(q&&!l?0:1)));e(bb,l);e(ub,l-(q?0:p.x));e(vb,c);e(P,e(sa,a.speed)<0);e(aa,a.velocity||0);e(ia,a.vertical);e(T,0);e(ja,Xa(1,!a.cw&&!l));e(cb,{});e(ta,false);e(Ka,e(db,0));e(La,e(Ma,0));e(ua,false);e(U,false);e(wb,a.brake);e(eb,!!a.orbital);e(ba,a.tempo/(o.lazy?a.laziness:1));e(ka,-1);e(Na,a.annotations||K.unbind(s(Na))&&{});e(xb,{src:d,classes:$,style:f||J,data:h});a.steppable||K.unbind("click.steppable");a.indicator||K.unbind(".indicator");C(J,{width:p.x,height:p.y,overflow:fb,
position:"relative"});C(ca+B+s(y),{display:yb});Q.bind(w.pool);j.trigger("setup")}},instance:{teardown:function(){var d=j.data(xb);j.parent().unbind(w.instance);b(pa).remove();b(gb).enableTextSelect();Qb(j.unbind(V).removeData().siblings().unbind(V).remove().end().attr({"class":d.classes,src:d.src,style:d.style}).data(d.data).unwrap());Oa();Q.unbind(w.pool);R.unbind(W)},setup:function(){function d(i){return function(l){if(l.button==Ub)return l.preventDefault()||j.trigger("down",[Fa(l).clientX,Fa(l).clientY])&&
i}}var c=b(G);b(F);j.attr(ga);var f=j.parent();area=e(gb,m(a.area||f));if(Ga){C(B+s(y),{WebkitUserSelect:Pa,WebkitBackgroundSize:b(Z).length?n:b(bb)&&z(b(bb))+B+z(c.y)||z(c.x*a.footage)+B+z(c.y*b(ab)*(a.rows||1)*(a.directional?2:1))});area.bind(Vb,d())}else{c=a.cursor==zb?Wb:a.cursor||Xb;var h=a.cursor==zb?Yb+B+"!important":n;C(J,{cursor:c});C(s(hb),{cursor:"wait"});C(s(Qa)+ca+s(Qa)+" *",{cursor:h||c},true);area.bind(a.wheelable?Zb:J,function(i,l){return i.preventDefault()||!l||j.trigger("wheel",
[l])&&false}).bind(a.clickfree?$b:ac,d()).disableTextSelect()}a.hint&&area.attr("title",a.hint);a.indicator&&f.append(va("x"));a.rows>1&&a.indicator&&f.append(va("y"));a.monitor&&f.append(Ab=m(S(ra),{"class":Bb}))&&C(B+s(Bb),{position:Ra,left:0,top:0});C(B+s(Cb),{display:Pa})},preload:function(){function d(K,Db){setTimeout(function(){Db.parent().length&&Db.attr({src:K})},(ha-p.length)*2)}var c=b(G),f=j.parent(),h=b(Z),i=!h.length,l=b(F),q=o.preload[a.preload]||o.preload[o.def.preload],p=i?[b($a)]:
q(h.slice(0),a,b),ha=p.length;e(T,i?0.5:0);h=[];f.addClass(hb).append(la());e(pa,m("<"+pa+' type="text/css">'+C.rules.join("\n")+"</"+pa+">").prependTo(ib));for(j.trigger("stop");p.length;){q=a.path+p.shift();var O=c.x*(!i?1:a.footage),$=c.y*(!i?1:l/a.footage)*(!a.directional?1:2);O=m(S(Ya)).attr({"class":Cb,width:O,height:$}).appendTo(f);O.bind("error load",function(){return!!m(this).parent().length&&j.trigger("preloaded")&&false});d(q,O);h.push(q)}e(sb,h)},preloaded:function(){var d=b(Z).length||
1,c=e(T,Wa(b(T)+1,d));if(c===d){j.parent().removeClass(hb).unbind(T,w.instance.preloaded);j.trigger("loaded")}c===1&&j.trigger("frameChange",[n,b(X)])},loaded:function(){b(Z).length>1||j.css({backgroundImage:Ea(a.path+b($a))}).attr({src:bc})},opening:function(){if(!a.opening)return j.trigger("openingDone");e(U,true);e(Sa,!b(sa));var d=a.entry||a.speed,c=b(x),f=a.opening;e(x,c-d*a.opening);e(ka,qa(f*Y(ba)))},openingDone:function(){e(wa,false);e(U,false);var d=ma+s(U);Q.unbind(d,w.pool[d]);if(a.delay>
0)L=setTimeout(function(){j.trigger("play")},a.delay*1E3);else j.trigger("play")},play:function(d,c){c=e(sa,c||b(sa));d=e(wa,!!c);e(Sa,!d);da()},pause:function(){e(wa,false);E()},stop:function(){var d=e(Sa,true);e(wa,!d)},down:function(d,c,f){function h(l){return function(q){q.preventDefault();j.trigger("pan",[Fa(q).clientX,Fa(q).clientY,q]);return l}}function i(l){return function(q){q.preventDefault();j.trigger("up");return l}}if(a.draggable){e(ta,b(X));e(aa,0);d=!b(ua)||a.rows<=1||!a.orbital||a.scrollable;
Ta=Ua(b(Ia),c,f);E();Oa();t=false;m(Eb,R).addClass(Qa);Ga?R.bind(cc,h(!d)).bind(dc+B+ec,i()):(a.clickfree?b(gb):R).bind(fc,h()).bind(a.clickfree?gc:hc,i())}},up:function(){if(a.draggable){e(ta,false);e(ua,false);ea=e(aa,!a.throwable?0:M(xa[0]+xa[1])/60)?1:0;E();Oa();b(Sa)||j.trigger("play");m(Eb,R).removeClass(Qa);R.unbind(W)}},pan:function(d,c,f,h){if(a.draggable&&jb){jb=false;E();d=h&&!m(h.currentTarget).is(Q)?ic.offset():{left:0,top:0};c-=d.left;f-=d.top;var i={x:c-Ta.x,y:f-Ta.y};if(M(i.x)>0||
M(i.y)>0){t=true;Ta={x:c,y:f};d=b(Ia);h=b(cb);var l=b(ia),q=e(x,Fb(l?f-h.y:c-h.x,b(Ka),d,b(La),b(Ma),b(ja),l?f-h.y:c-h.x));e(ua,b(ua)||b(X)!=b(ta));(i=Gb(l?i.y:i.x||0))&&e(P,i<0);if(a.orbital&&b(eb)){e(ia,M(f-h.y)>M(c-h.x));h=Ua(d,c,f)}if(a.rows>1){i=b(G).y;i=a.rows>3?i:i/(5-a.rows);l=b(db);var p=-l*i;e(ya,o.math.envelope(f-h.y,l,i,p,p+i,-1))}!(q%1)&&!a.loops&&Ua(d,c,f)}}},wheel:function(d,c){if(c){d=qa(fa.sqrt(M(c))/2);d=Xa(d,c>0);c=0.0833*b(Ia);Ua(c);d&&e(P,d<0);e(aa,0);e(x,Fb(d,b(Ka),c,b(La),b(Ma),
b(ja)));E();j.trigger("up");return false}},fractionChange:function(d,c,f){if(c!==n)return pb(e(x,c));d=1+Va(f/b(Ja));c=a.rows>1;f=a.orbital;e(eb,!!f&&(d<=f||d>=a.footage-f+2));if(c)d+=(b(za)-1)*b(F);e(X,d)},tierChange:function(d,c,f){if(c===n){d=e(za,H(Aa(f,1,a.rows)));c=b(F);f=b(X)%c||c;e(X,f+d*c-c)}},rowChange:function(d,c,f){if(c!==n)return e(za,c);e(ya,1/(a.rows-1)*(f-1))},frameChange:function(d,c,f){if(c!==n)return pb(e(X,c));this.className=this.className.replace(o.re.frame_klass,rb+f);c=b(F);
var h=f%c||c;d=!!b(T);var i=((f-h)/c+1-1)/(a.rows-1),l=H(Aa(i,1,a.rows));d&&l===b(za)?b(ya):e(ya,i);h=Wa((h-1)/(c-1),0.9999);i=b(za)*c-c;c=H(Aa(h,i+1,i+c));i=M((b(x)||0)-h)<1/(b(F)-1);var q=d&&c===f&&i?b(x):e(x,h);l=a.footage;if(a.orbital&&b(ia)){f=a.inversed?l+1-f:f;f+=l}c=a.horizontal;h=b(Z);var p=!h.length;i=b(G);if(p){if(a.stitched){f=H(Aa(q,0,b(ub)))%a.stitched;f=[z(-f),z(0)]}else{d=f%l-1;d=d<0?l-1:d;l=Va((f-0.1)/l);l+=a.rows>1?0:b(P)?0:b(ab);f=b(tb);l=l*((c?i.y:i.x)+f);f=d*((c?i.x:i.y)+f);f=
h.length?[0,0]:c?[z(-f),z(-l)]:[z(-l),z(-f)]}j.css({backgroundPosition:f.join(B)})}else{f=h[f-1];d&&j.attr({src:a.path+f})}},"click.steppable":function(d){if(t)return D(d,false);j.trigger(d.clientX-j.offset().left>0.5*b(G).x?"stepRight":"stepLeft")},"stepLeft stepRight":function(){E()},stepLeft:function(){e(P,false);e(x,b(x)-b(Ja)*b(ja))},stepRight:function(){e(P,true);e(x,b(x)+b(Ja)*b(ja))},"fractionChange.indicator":function(d,c,f){if(c===n&&a.indicator){d=b(G);d=a.orbital&&b(ia)?d.y:d.x;var h=
a.orbital?a.footage:a.images.length||b(F);c=a.indicator;h=qa(d/h);d-=h;f=H(Aa(f,0,d));f=!a.cw||a.stitched?f:d-f;va.$x.css(b(ia)?{left:0,top:z(f),bottom:Hb,width:c,height:h}:{bottom:0,left:z(f),top:Hb,width:h,height:c})}},"tierChange.indicator":function(d,c,f){if(c===n&&a.rows>1&&a.indicator){var h=b(G).y;d=a.indicator;c=qa(h/a.rows);h-=c;f=H(f*h);va.$y.css({left:0,top:f,width:d,height:c})}},"setup.annotations":function(){b(G);var d=j.parent();m.each(b(Na),function(c,f){var h=typeof f.node==ob?m(f.node):
f.node||{};h=h.jquery?h:m(S(ra),h);h=h.attr({id:c}).addClass(jc);var i=f.image?m(S(Ya),f.image):m(),l=f.link?m(S("a"),f.link):m();C(Ca(c),{display:Pa,position:Ra},true);h.bind({"click.annotations":function(q){q.stopPropagation()}});f.image||f.link&&h.append(l);f.link||f.image&&h.append(i);f.link&&f.image&&h.append(l.append(i));h.appendTo(d)})},"frameChange.annotations":function(d,c,f){c===n&&!b(aa)&&m.each(b(Na),function(h,i){h=m(Ca(h));var l=i.start||1,q=i.end,p=f-1,ha=i.at?i.at[p]=="+":false;p=
i.at?p:p-l+1;var O=typeof i.x!=Ib?i.x:i.x[p],$=typeof i.y!=Ib?i.y:i.y[p];i={display:O!==n&&$!==n&&(i.at?ha:p>=0&&(!q||p<=q-l))?yb:Pa,left:z(O),top:z($)};h.css(i)})},"setup.fu":function(){e(X,a.frame+(a.row-1)*b(F));j.trigger("preload")},"loaded.fu":function(){j.trigger("opening")}},pool:{"tick.reel.preload":function(){var d=b(G),c=oa(la.$.css(Za)),f=b(Z).length||1,h=H(1/f*b(T)*d.x);la.$.css({width:c+(h-c)/3+1});if(b(T)===f&&c>d.x-1){la.$.fadeOut(300,function(){la.$.remove()});Q.unbind(ma+s(Jb),w.pool[ma+
s(Jb)])}},"tick.reel":function(d){var c=b(aa),f=Y(ba);if(ea){c=c-b(wb)/f*ea;c=e(aa,c>0.1?c:(ea=A=0))}a.monitor&&Ab.text(b(a.monitor));c&&ea++;A&&A++;Gb(0);jb=true;if(A&&!c)return D(d);if(b(ta))return D(d,E());if(!(b(ka)>0)){if(!a.loops&&a.rebound){!A&&!(b(x)%1)?kb++:(kb=0);kb>=a.rebound*1E3/f&&e(P,!b(P))}d=b(ja)*Xa(1,b(P));c=(!b(wa)?c:M(b(sa))+c)/Y(ba);e(x,b(x)-c*d)}},"tick.reel.opening":function(){if(b(U)){var d=(a.entry||a.speed)/Y(ba)*(a.cw?-1:1),c=e(ka,b(ka)-1);e(x,b(x)+d);c||j.trigger("openingDone")}}}},
D=function(d,c){return d.stopImmediatePropagation()||c},A,ea=0,da=function(){return A=0},E=function(){clearTimeout(L);Q.unbind(ma+s(U),w.pool[ma+s(U)]);e(ka,0);return A=-a.timeout*Y(ba)},t=false,L,Ab=m(),la=function(){C(B+s(Kb),{position:Ra,left:0,top:b(G).y-a.preloader,height:a.preloader,overflow:fb,backgroundColor:"#000"});return la.$=m(S(ra),{"class":Kb})},va=function(d){C(B+s(Lb)+s(d),{position:Ra,width:0,height:0,overflow:fb,backgroundColor:"#000"});return va["$"+d]=m(S(ra),{"class":Lb+B+d})},
C=function(d,c,f){function h(i){var l=[];m.each(i,function(q,p){l.push(q.replace(/([A-Z])/g,"-$1").toLowerCase()+":"+z(p)+";")});return"{"+l.join(J)+"}"}f=f?J:b(vb);d=d.replace(/^/,f).replace(ca,ca+f);return C.rules.push(d+h(c))&&c},kb=0,Ta={x:0,y:0},Gb=function(d){return xa.push(d)&&xa.shift()&&d},Oa=function(){return xa=[0,0]},xa=Oa(),Fb=a.graph||o.math[a.loops?"hatch":"envelope"],Ua=function(d,c,f){var h=e(Ka,b(x));e(db,b(ya));e(La,a.loops?0:-h*d);e(Ma,a.loops?d:d-h*d);return c&&e(cb,{x:c,y:f})||
n},jb=true,R;try{R=m.unique(Q.add(Ob.top.document))}catch(lc){R=Q}var ic=top===self?m():function(d){m("iframe",R.last()).each(function(){try{if(m(this).contents().find(ib).html()==m(ib).html())return(d=m(this))&&false}catch(c){}});return d}();C.rules=[];w.setup()});Mb=Mb||function j(){var e=+new Date,b=Y(ba),w;if(b){Q.trigger(ma);o.cost=(+new Date+o.cost-e)/2;w=setTimeout(j,nb(4,1E3/b-o.cost))}return w}();return m(N)}},unreel:function(){return this.trigger("teardown")}},re:{image:/^(.*)\.(jpg|jpeg|png|gif)$/,
touchy_agent:/iphone|ipod|ipad|android/i,lazy_agent:/iphone|ipod|android/i,frame_klass:/frame-\d+/,sequence:/(^[^#|]*([#]+)[^#|]*)($|[|]([0-9]+)\.\.([0-9]+))($|[|]([0-9]+)$)/},cdn:"http://code.vostrel.cz/",math:{envelope:function(g,k,r,u,v,I){return k+na(u,v,-g*I)/r},hatch:function(g,k,r,u,v,I){g=(g<u?v:0)+g%v;g=k+-g*I/r;return g-Va(g)},interpolate:function(g,k,r){return k+g*(r-k)}},preload:{linear:function(g){return g},fidelity:function(g,k,r){function u(j,e,b){function w(L){for(;!(L>=1&&L<=da);)L+=
L<1?+da:-da;return N[b+L]||(N[b+L]=!!D.push(L))}if(!j.length)return[];var D=[],A=4*e,ea=k.frame,da=j.length;e=true;for(var E=da/A,t=0;t<A;t++)w(ea+H(t*E));for(;E>1;){t=0;A=D.length;E/=2;for(e=!e;t<A;t++)w(D[t]+(e?1:-1)*H(E))}for(t=0;t<=da;t++)w(t);for(t=0;t<D.length;t++)D[t]=j[D[t]-1];return D}var v=k.orbital?2:k.rows||1,I=k.orbital?k.footage:r(F);r=(k.row-1)*I;var a=[].concat(g),N=new Array(g.length+1);g=v<2?[]:a.slice(r,r+I);return u(g,1,r).concat(u(a,v,0))}},normal:{fraction:function(g,k){return k[Ha].loops?
g-Va(g):na(0,1,g)},tier:function(g){return na(0,1,g)},row:function(g,k){return H(na(1,k[Ha].rows,g))},frame:function(g,k){var r=k[Ha];k=k[F]*(r.orbital?2:r.rows||1);g=H(r.loops?g%k||k:na(1,k,g));return g<0?g+k:g}},sequence:function(g,k){function r(j,e,b){for(;j.length<e;)j=b+j;return j}if(g.length<=1)return k.images;var u=[],v=g[1],I=g[2],a=+g[4]||1,N=k.orbital?2:k.rows||1;k=k.orbital?k.footage:k.frames;N=+(g[5]||N*k);g=+g[7]||1;for(k=0;k<N;){u.push(v.replace(I,r(a+k+J,I.length,"0")));k+=g}return u},
instances:m(),leader:Y,cost:0},Q=m(Ba);Ba=+m.browser.version.split(s()).slice(0,2).join(s());var lb=m.browser.msie,kc=!lb||lb&&Ba>6,Nb=navigator.userAgent,Mb,y="reel",Tb=y+"-overlay",Lb=y+"-indicator",Kb=y+"-preloader",Cb=y+"-cached",Bb=y+"-monitor",jc=y+"-annotation",Qa=y+"-panning",hb=y+"-loading",rb="frame-",fa=Math,H=fa.round,Va=fa.floor,qa=fa.ceil,Wa=fa.min,nb=fa.max,M=fa.abs,oa=parseInt,Aa=o.math.interpolate,Na="annotations",gb="area",Hb="auto",xb="backup",P="backwards",Ja="bit",wb="brake",
sb="cached",eb="center",ta="clicked",cb="clicked_location",Ka="clicked_on",db="clicked_tier",ja="cwish",G="dimensions",x="fraction",X="frame",F="frames",Ma="hi",fb="hidden",$a="image",Z="images",U="opening",ka=U+"_ticks",La="lo",Ha="options",wa="playing",T="preloaded",ua="reeling",Ia="revolution",za="row",ab="rows",tb="spacing",sa="speed",vb="stage",bb="stitched",ub="stitched_travel",Sa="stopped",pa="style",ba="tempo",ya="tier",aa="velocity",ia="vertical",V=s(y),W=".pan"+V,ac="mousedown"+V,$b="mouseenter"+
V,gc="mouseleave"+W,fc="mousemove"+W,hc="mouseup"+W,Zb="mousewheel"+V,ma="tick"+V,ec="touchcancel"+W,dc="touchend"+W,Vb="touchstart"+V,cc="touchmove"+W,J="",B=" ",ca=",",Ra="absolute",yb="block",ra="div",zb="hand",ib="head",qb="height",Eb="html",ga="id",Ya="img",mb="jquery."+y,Pa="none",Ib="object",Jb="preload",ob="string",Za="width",bc=kc?Rb("CAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7"):Da("blank.gif"),Xb=Ea(Da(mb+".cur"))+ca+"move",Wb=Ea(Da(mb+"-drag.cur"))+ca+"move",Yb=Ea(Da(mb+"-drag-down.cur"))+
ca+"move",Ga=o.touchy=o.re.touchy_agent.test(Nb);o.lazy=o.re.lazy_agent.test(Nb);var Ub=Ga?n:lb&&Ba<=8?1:0;Sb("disableTextSelect enableTextSelect".split(/ /));m.extend(m.fn,o.fn)}(jQuery,window,document);
