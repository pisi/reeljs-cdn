/*
 Copyright (c) 2009-2012 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 jQuery Reel
 http://jquery.vostrel.cz/reel
 Version: 1.2rc
 Updated: 2012-03-29

 Requires jQuery 1.5 or higher
*/
jQuery.reel||function(l,Pb,Aa,o){function Qb(g){return p.instances.push(g[0])&&g}function Rb(g){return(p.instances=p.instances.not(Ba(g.attr(ea))))&&g}function X(g){return p.instances.length?p.instances.first().data(g):null}function Sb(g){return"data:image/gif;base64,R0lGODlh"+g}function S(g){return"<"+g+"/>"}function s(g){return"."+(g||"")}function Ca(g){return p.cdn+g}function Da(g){return"url("+g+")"}function ma(g,j,q){return ob(g,Va(j,q))}function Tb(g){function j(){l.fn[this]||(l.fn[this]=function(){return this})}
l.each(g,j)}function Wa(g,j){return N(g)*(j?-1:1)}function Ea(g){return Fa?g.touch||g.originalEvent.touches[0]:g}function z(g){return g===o?0:typeof g==pb?g:g+"px"}function Ba(g){return"#"+g}function Ub(g,j,q){for(;g.length<j;)g=q+g;return g}function qb(g){try{console.warn("Deprecation - Please consult https://github.com/pisi/Reel/wiki/Deprecations")}catch(j){}return g}if(+l().jquery.replace(s(),"").substr(0,2)<15)throw"VersionError: far too old jQuery for running Reel";var p=l.reel={version:"1.2rc",
def:{frame:1,frames:36,loops:true,clickfree:false,draggable:true,scrollable:true,steppable:true,throwable:true,wheelable:true,cw:false,revolution:o,stitched:0,directional:false,row:1,rows:0,orbital:0,vertical:false,inversed:false,footage:6,spacing:0,horizontal:true,suffix:"-reel",image:o,images:"",path:"",preload:"fidelity",speed:0,delay:0,timeout:2,rebound:0.5,entry:o,opening:0,brake:0.23,velocity:0,tempo:36,laziness:6,cursor:o,hint:"",indicator:0,klass:"",preloader:2,area:o,attr:{},annotations:o,
graph:o,monitor:o,step:o,steps:o},fn:{reel:function(){var g=arguments,j=l(this),q=j.data(),v=g[0]||{},t=g[1];if(typeof v=="object"){var a=l.extend({},p.def,v);g=function(k){var e=[];k.filter(Xa).each(function(){var c=l(this),w=a.images.length&&a.images||a.sequence||a.image||a.attr.src||c.attr("src"),D=na(a.attr.width||c.css(Ya)),A=na(a.attr.height||c.css(rb));w&&w!=J&&D&&A&&e.push(c)});k.filter(s(y)).each(function(){e.push(l(this).unreel())});return l(e)}(this);var O=[];a.step&&(a.frame=a.step);a.steps&&
(a.frames=a.steps);g.each(function(){var k=l(this),e=function(d,b){return k.reel(d,b)&&b},c=function(d){return k.reel(d)},w={setup:function(){if(!k.hasClass(y)){e(Ga,a);var d=k.attr(a.attr).attr("src"),b=e(ea,k.attr(ea)||k.attr(ea,y+"-"+ +new Date).attr(ea)),f=k.attr(oa),h=l.extend({},k.data()),i=p.re.sequence.exec(a.images);i=e(Y,i?p.sequence(i,a,c):a.images||[]);var m=a.stitched,n=a.loops,r={x:na(k.css(Ya)||a.attr.width),y:na(k.css(rb)||a.attr.height)},fa=e(G,a.orbital&&a.footage||a.rows<=1&&i.length||
a.frames),E=m?1:pa(fa/a.footage);b=Ba(b+a.suffix);var Z=k[0].className||J,K=l(S(qa),{id:b.substr(1),"class":Z+B+Vb+B+sb+"0"});K=k.wrap(K.addClass(a.klass)).attr({"class":y});O.push(Qb(K)[0]);K=K.parent().bind(w.instance);e(Za,i.length?J:a.image||d.replace(p.re.image,"$1"+a.suffix+".$2"));e(tb,[]);e(ub,a.spacing);e($a,E);e(H,r);e(Ha,a.revolution||m/2||r.x*2);e(Ia,1/(fa-(n&&!m?0:1)));e(ab,m);e(vb,m-(n?0:r.x));e(bb,0);e(wb,b);e(L,e(ra,a.speed)<0);e(ga,a.velocity||0);e(ha,a.vertical);e(P,0);e(ia,Wa(1,
!a.cw&&!m));e(cb,{});e(sa,false);e(Ja,e(db,0));e(Ka,e(La,0));e(ta,false);e(T,false);e(xb,a.brake);e(eb,!!a.orbital);e($,a.tempo/(p.lazy?a.laziness:1));e(ja,-1);e(Ma,a.annotations||K.unbind(s(Ma))&&{});e(yb,{src:d,classes:Z,style:f||J,data:h});a.steppable||K.unbind("click.steppable");a.indicator||K.unbind(".indicator");C(J,{width:r.x,height:r.y,overflow:fb,position:"relative"});C(aa+B+s(y),{display:zb});Q.bind(w.pool);k.trigger("setup")}},instance:{teardown:function(){var d=k.data(yb);k.parent().unbind(w.instance);
c(oa).remove();c(Na).enableTextSelect();Rb(k.unbind(U).removeData().siblings().unbind(U).remove().end().attr({"class":d.classes,src:d.src,style:d.style}).data(d.data).unwrap());Oa();Q.unbind(w.pool);R.unbind(V)},setup:function(){function d(i){return function(m){if(m.button==Wb)return m.preventDefault()||k.trigger("down",[Ea(m).clientX,Ea(m).clientY])&&i}}var b=c(H);c(G);k.attr(ea);var f=k.parent();area=e(Na,l(a.area||f));if(Fa){C(B+s(y),{WebkitUserSelect:Pa,WebkitBackgroundSize:c(Y).length?o:c(ab)&&
z(c(ab))+B+z(b.y)||z(b.x*a.footage)+B+z(b.y*c($a)*(a.rows||1)*(a.directional?2:1))});area.bind(Xb,d())}else{b=a.cursor==Ab?Yb:a.cursor||Zb;var h=a.cursor==Ab?$b+B+"!important":o;C(J,{cursor:b});C(s(gb),{cursor:"wait"});C(s(Qa)+aa+s(Qa)+" *",{cursor:h||b},true);area.bind(a.wheelable?ac:J,function(i,m){return i.preventDefault()||!m||k.trigger("wheel",[m])&&false}).bind(a.clickfree?bc:cc,d()).disableTextSelect()}a.hint&&area.attr("title",a.hint);a.indicator&&f.append(ua("x"));a.rows>1&&a.indicator&&
f.append(ua("y"));a.monitor&&f.append(Bb=l(S(qa),{"class":Cb}))&&C(B+s(Cb),{position:Ra,left:0,top:0});C(B+s(Db),{display:Pa})},preload:function(){function d(K,Eb){setTimeout(function(){Eb.parent().length&&Eb.attr({src:K})},(fa-r.length)*2)}var b=c(H),f=k.parent(),h=c(Y),i=!h.length,m=c(G),n=p.preload[a.preload]||p.preload[p.def.preload],r=i?[c(Za)]:n(h.slice(0),a,c),fa=r.length;e(P,i?0.5:0);h=[];f.addClass(gb).append(ka());e(oa,l("<"+oa+' type="text/css">'+C.rules.join("\n")+"</"+oa+">").prependTo(hb));
for(k.trigger("stop");r.length;){n=a.path+r.shift();var E=b.x*(!i?1:a.footage),Z=b.y*(!i?1:m/a.footage)*(!a.directional?1:2);E=l(S(Xa)).attr({"class":Db,width:E,height:Z}).appendTo(f);E.bind("load error abort",function(){return!!l(this).parent().length&&k.trigger("preloaded")&&false});d(n,E);h.push(n)}e(tb,h)},preloaded:function(){var d=c(Y).length||1,b=e(P,Va(c(P)+1,d));if(b===d){k.parent().removeClass(gb).unbind(P,w.instance.preloaded);k.trigger("loaded")}b===1&&k.trigger("frameChange",[o,c(W)])},
loaded:function(){c(Y).length>1||k.css({backgroundImage:Da(a.path+c(Za))}).attr({src:dc})},opening:function(){if(!a.opening)return k.trigger("openingDone");e(T,true);e(ib,!c(ra));var d=a.entry||a.speed,b=c(x),f=a.opening;e(x,b-d*a.opening);e(ja,pa(f*X($)))},openingDone:function(){e(va,false);e(T,false);var d=la+s(T);Q.unbind(d,w.pool[d]);if(a.delay>0)M=setTimeout(function(){k.trigger("play")},a.delay*1E3);else k.trigger("play")},play:function(d,b){b=e(ra,b||c(ra));e(L,b<0);d=e(va,!!b);e(ib,!d);ba()},
pause:function(){e(va,false);F()},stop:function(){var d=e(ib,true);e(va,!d)},down:function(d,b,f){function h(m){return function(n){n.preventDefault();k.trigger("pan",[Ea(n).clientX,Ea(n).clientY,n]);return m}}function i(m){return function(n){n.preventDefault();k.trigger("up");return m}}if(a.draggable){e(sa,c(W));e(ga,0);d=!c(ta)||a.rows<=1||!a.orbital||a.scrollable;Sa=Ta(c(Ha),b,f);F();Oa();u=false;l(Fb,R).addClass(Qa);Fa?R.bind(ec,h(!d)).bind(fc+B+gc,i()):(a.clickfree?c(Na):R).bind(hc,h()).bind(a.clickfree?
ic:jc,i())}},up:function(){if(a.draggable){e(sa,false);e(ta,false);ca=e(ga,!a.throwable?0:N(wa[0]+wa[1])/60)?1:0;F();Oa();l(Fb,R).removeClass(Qa);(a.clickfree?c(Na):R).unbind(V)}},pan:function(d,b,f,h){if(a.draggable&&jb){jb=false;F();d=h&&!l(h.currentTarget).is(Q)&&kc.offset()||{left:0,top:0};b-=d.left;f-=d.top;var i={x:b-Sa.x,y:f-Sa.y};if(N(i.x)>0||N(i.y)>0){u=true;Sa={x:b,y:f};d=c(Ha);h=c(cb);var m=c(ha),n=e(x,Gb(m?f-h.y:b-h.x,c(Ja),d,c(Ka),c(La),c(ia),m?f-h.y:b-h.x));e(ta,c(ta)||c(W)!=c(sa));
(i=Hb(m?i.y:i.x||0))&&e(L,i<0);if(a.orbital&&c(eb)){e(ha,N(f-h.y)>N(b-h.x));h=Ta(d,b,f)}if(a.rows>1){i=c(H).y;i=a.rows>3?i:i/(5-a.rows);m=c(db);var r=-m*i;e(xa,p.math.envelope(f-h.y,m,i,r,r+i,-1))}!(n%1)&&!a.loops&&Ta(d,b,f)}}},wheel:function(d,b){if(b){d=pa(da.sqrt(N(b))/2);d=Wa(d,b>0);b=0.0833*c(Ha);Ta(b);d&&e(L,d<0);e(ga,0);e(x,Gb(d,c(Ja),b,c(Ka),c(La),c(ia)));F();k.trigger("up");return false}},fractionChange:function(d,b,f){if(b!==o)return qb(e(x,b));d=1+Ua(f/c(Ia));b=a.rows>1;f=a.orbital;e(eb,
!!f&&(d<=f||d>=a.footage-f+2));if(b)d+=(c(ya)-1)*c(G);e(W,d)},tierChange:function(d,b,f){if(b===o){d=e(ya,I(za(f,1,a.rows)));b=c(G);f=c(W)%b||b;e(W,f+d*b-b)}},rowChange:function(d,b,f){if(b!==o)return e(ya,b);e(xa,1/(a.rows-1)*(f-1))},frameChange:function(d,b,f){if(b!==o)return qb(e(W,b));this.className=this.className.replace(p.re.frame_klass,sb+f);b=c(G);var h=f%b||b;d=!!c(P);var i=((f-h)/b+1-1)/(a.rows-1),m=I(za(i,1,a.rows));d&&m===c(ya)?c(xa):e(xa,i);i=Va((h-1)/(b-1),0.9999);h=c(ya)*b-b;b=I(za(i,
h+1,h+b));h=N((c(x)||0)-i)<1/(c(G)-1);d&&b===f&&h?c(x):e(x,i);var n=a.footage;if(a.orbital&&c(ha)){f=a.inversed?n+1-f:f;f+=n}b=a.horizontal;h=c(Y);var r=!h.length;m=c(H);if(r){if(a.stitched){f=e(bb,I(za(i,0,c(vb)))%a.stitched);f=[z(-f),z(0)]}else{d=f%n-1;d=d<0?n-1:d;i=Ua((f-0.1)/n);i+=a.rows>1?0:c(L)?0:c($a);f=c(ub);i=i*((b?m.y:m.x)+f);f=d*((b?m.x:m.y)+f);f=h.length?[0,0]:b?[z(-f),z(-i)]:[z(-i),z(-f)]}k.css({backgroundPosition:f.join(B)})}else{f=h[f-1];d&&k.attr({src:a.path+f})}},"click.steppable":function(d){if(u)return D(d,
false);k.trigger(d.clientX-k.offset().left>0.5*c(H).x?"stepRight":"stepLeft")},"stepLeft stepRight":function(){F()},stepLeft:function(){e(L,false);e(x,c(x)-c(Ia)*c(ia))},stepRight:function(){e(L,true);e(x,c(x)+c(Ia)*c(ia))},"fractionChange.indicator":function(d,b,f){if(b===o&&a.indicator){d=c(H);d=a.orbital&&c(ha)?d.y:d.x;var h=a.orbital?a.footage:a.images.length||c(G);b=a.indicator;h=pa(d/h);d-=h;f=I(za(f,0,d));f=!a.cw||a.stitched?f:d-f;ua.$x.css(c(ha)?{left:0,top:z(f),bottom:Ib,width:b,height:h}:
{bottom:0,left:z(f),top:Ib,width:h,height:b})}},"tierChange.indicator":function(d,b,f){if(b===o&&a.rows>1&&a.indicator){var h=c(H).y;d=a.indicator;b=pa(h/a.rows);h-=b;f=I(f*h);ua.$y.css({left:0,top:f,width:d,height:b})}},"setup.annotations":function(){c(H);var d=k.parent();l.each(c(Ma),function(b,f){var h=typeof f.node==pb?l(f.node):f.node||{};h=h.jquery?h:l(S(qa),h);h=h.attr({id:b}).addClass(lc);var i=f.image?l(S(Xa),f.image):l(),m=f.link?l(S("a"),f.link):l();C(Ba(b),{display:Pa,position:Ra},true);
h.bind({"click.annotations":function(n){n.stopPropagation()}});f.image||f.link&&h.append(m);f.link||f.image&&h.append(i);f.link&&f.image&&h.append(m.append(i));h.appendTo(d)})},"frameChange.annotations":function(d,b,f){c(P)&&b===o&&l.each(c(Ma),function(h,i){h=l(Ba(h));var m=i.start||1,n=i.end,r=f-1,fa=i.at?i.at[r]=="+":false;r=i.at?r:r-m+1;var E=typeof i.x!=Jb?i.x:i.x[r],Z=typeof i.y!=Jb?i.y:i.y[r];i=E!==o&&Z!==o&&(i.at?fa:r>=0&&(!n||r<=n-m));E=!a.stitched?E:E-c(bb);i={display:i?zb:Pa,left:z(E),
top:z(Z)};h.css(i)})},"setup.fu":function(){e(W,a.frame+(a.row-1)*c(G));k.trigger("preload")},"loaded.fu":function(){k.trigger("opening")}},pool:{"tick.reel.preload":function(){var d=c(H),b=na(ka.$.css(Ya)),f=c(Y).length||1,h=I(1/f*c(P)*d.x);ka.$.css({width:b+(h-b)/3+1});if(c(P)===f&&b>d.x-1){ka.$.fadeOut(300,function(){ka.$.remove()});Q.unbind(la+s(Kb),w.pool[la+s(Kb)])}},"tick.reel":function(d){var b=c(ga),f=X($);if(ca){b=b-c(xb)/f*ca;b=e(ga,b>0.1?b:(ca=A=0))}a.monitor&&Bb.text(c(a.monitor));b&&
ca++;A&&A++;Hb(0);jb=true;if(A&&!b)return D(d);if(c(sa))return D(d,F());if(!(c(ja)>0)){if(!a.loops&&a.rebound){!A&&!(c(x)%1)?kb++:(kb=0);kb>=a.rebound*1E3/f&&e(L,!c(L))}d=c(ia)*Wa(1,c(L));b=(!c(va)?b:N(c(ra))+b)/X($);e(x,c(x)-b*d)}},"tick.reel.opening":function(){if(c(T)){var d=(a.entry||a.speed)/X($)*(a.cw?-1:1),b=e(ja,c(ja)-1);e(x,c(x)+d);b||k.trigger("openingDone")}}}},D=function(d,b){return d.stopImmediatePropagation()||b},A,ca=0,ba=function(){return A=0},F=function(){clearTimeout(M);Q.unbind(la+
s(T),w.pool[la+s(T)]);e(ja,0);return A=-a.timeout*X($)},u=false,M,Bb=l(),ka=function(){C(B+s(Lb),{position:Ra,left:0,top:c(H).y-a.preloader,height:a.preloader,overflow:fb,backgroundColor:"#000"});return ka.$=l(S(qa),{"class":Lb})},ua=function(d){C(B+s(Mb)+s(d),{position:Ra,width:0,height:0,overflow:fb,backgroundColor:"#000"});return ua["$"+d]=l(S(qa),{"class":Mb+B+d})},C=function(d,b,f){function h(i){var m=[];l.each(i,function(n,r){m.push(n.replace(/([A-Z])/g,"-$1").toLowerCase()+":"+z(r)+";")});
return"{"+m.join(J)+"}"}f=f?J:c(wb);d=d.replace(/^/,f).replace(aa,aa+f);return C.rules.push(d+h(b))&&b},kb=0,Sa={x:0,y:0},Hb=function(d){return wa.push(d)&&wa.shift()&&d},Oa=function(){return wa=[0,0]},wa=Oa(),Gb=a.graph||p.math[a.loops?"hatch":"envelope"],Ta=function(d,b,f){var h=e(Ja,c(x));e(db,c(xa));e(Ka,a.loops?0:-h*d);e(La,a.loops?d:d-h*d);return b&&e(cb,{x:b,y:f})||o},jb=true,R;try{R=l.unique(Q.add(Pb.top.document))}catch(nc){R=Q}var kc=top===self?l():function(d){l("iframe",R.last()).each(function(){try{if(l(this).contents().find(hb).html()==
l(hb).html())return(d=l(this))&&false}catch(b){}});return d}();C.rules=[];w.setup()});Nb=Nb||function k(){var e=+new Date,c=X($),w;if(c){Q.trigger(la);p.cost=(+new Date+p.cost-e)/2;w=setTimeout(k,ob(4,1E3/c-p.cost))}return w}();return l(O)}else if(typeof v=="string")if(g.length==1){t=q[v];j.trigger("recall",[v,t]);return t}else{if(t!==o){try{t=p.normal[v](t,q)}catch(lb){}if(q[v]!==t)j.trigger(v+"Change",[o,q[v]=t])}return j.trigger("store",[v,t])}},unreel:function(){return this.trigger("teardown")}},
re:{image:/^(.*)\.(jpg|jpeg|png|gif)\??.*$/,touchy_agent:/iphone|ipod|ipad|android|fennec|rim tablet/i,lazy_agent:/\(iphone|ipod|android|fennec|blackberry/i,frame_klass:/frame-\d+/,sequence:/(^[^#|]*([#]+)[^#|]*)($|[|]([0-9]+)\.\.([0-9]+))($|[|]([0-9]+)$)/},cdn:"http://code.vostrel.cz/",math:{envelope:function(g,j,q,v,t,a){return j+ma(v,t,-g*a)/q},hatch:function(g,j,q,v,t,a){g=(g<v?t:0)+g%t;g=j+-g*a/q;return g-Ua(g)},interpolate:function(g,j,q){return j+g*(q-j)}},preload:{fidelity:function(g,j,q){function v(k,
e,c){function w(M){for(;!(M>=1&&M<=ba);)M+=M<1?+ba:-ba;return lb[c+M]||(lb[c+M]=!!D.push(M))}if(!k.length)return[];var D=[],A=4*e,ca=j.frame,ba=k.length;e=true;for(var F=ba/A,u=0;u<A;u++)w(ca+I(u*F));for(;F>1;){u=0;A=D.length;F/=2;for(e=!e;u<A;u++)w(D[u]+(e?1:-1)*I(F))}for(u=0;u<=ba;u++)w(u);for(u=0;u<D.length;u++)D[u]=k[D[u]-1];return D}var t=j.orbital?2:j.rows||1,a=j.orbital?j.footage:q(G);q=(j.row-1)*a;var O=[].concat(g),lb=new Array(g.length+1);g=t<2?[]:O.slice(q,q+a);return v(g,1,q).concat(v(O,
t,0))},linear:function(g){return g}},normal:{fraction:function(g,j){return j[Ga].loops?g-Ua(g):ma(0,1,g)},tier:function(g){return ma(0,1,g)},row:function(g,j){return I(ma(1,j[Ga].rows,g))},frame:function(g,j){var q=j[Ga];j=j[G]*(q.orbital?2:q.rows||1);g=I(q.loops?g%j||j:ma(1,j,g));return g<0?g+j:g}},sequence:function(g,j){if(g.length<=1)return j.images;var q=[],v=g[1],t=g[2],a=+g[4]||1,O=j.orbital?2:j.rows||1;j=j.orbital?j.footage:j.frames;O=+(g[5]||O*j);g=+g[7]||1;for(j=0;j<O;){q.push(v.replace(t,
Ub(a+j+J,t.length,"0")));j+=g}return q},instances:l(),leader:X,cost:0},Q=l(Aa);Aa=+l.browser.version.split(s()).slice(0,2).join(s());var mb=l.browser.msie,mc=!mb||mb&&Aa>6,Ob=navigator.userAgent,Nb,y="reel",Vb=y+"-overlay",Mb=y+"-indicator",Lb=y+"-preloader",Db=y+"-cached",Cb=y+"-monitor",lc=y+"-annotation",Qa=y+"-panning",gb=y+"-loading",sb="frame-",da=Math,I=da.round,Ua=da.floor,pa=da.ceil,Va=da.min,ob=da.max,N=da.abs,na=parseInt,za=p.math.interpolate,Ma="annotations",Na="area",Ib="auto",yb="backup",
L="backwards",Ia="bit",xb="brake",tb="cached",eb="center",sa="clicked",cb="clicked_location",Ja="clicked_on",db="clicked_tier",ia="cwish",H="dimensions",x="fraction",W="frame",G="frames",La="hi",fb="hidden",Za="image",Y="images",T="opening",ja=T+"_ticks",Ka="lo",Ga="options",va="playing",P="preloaded",ta="reeling",Ha="revolution",ya="row",$a="rows",ub="spacing",ra="speed",wb="stage",ab="stitched",bb="stitched_shift",vb="stitched_travel",ib="stopped",oa="style",$="tempo",xa="tier",ga="velocity",ha=
"vertical",U=s(y),V=".pan"+U,cc="mousedown"+U,bc="mouseenter"+U,ic="mouseleave"+V,hc="mousemove"+V,jc="mouseup"+V,ac="mousewheel"+U,la="tick"+U,gc="touchcancel"+V,fc="touchend"+V,Xb="touchstart"+U,ec="touchmove"+V,J="",B=" ",aa=",",Ra="absolute",zb="block",qa="div",Ab="hand",hb="head",rb="height",Fb="html",ea="id",Xa="img",nb="jquery."+y,Pa="none",Jb="object",Kb="preload",pb="string",Ya="width",dc=mc?Sb("CAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7"):Ca("blank.gif"),Zb=Da(Ca(nb+".cur"))+
aa+"move",Yb=Da(Ca(nb+"-drag.cur"))+aa+"move",$b=Da(Ca(nb+"-drag-down.cur"))+aa+"move",Fa=p.touchy=p.re.touchy_agent.test(Ob);p.lazy=p.re.lazy_agent.test(Ob);var Wb=Fa?o:mb&&Aa<=8?1:0;Tb("disableTextSelect enableTextSelect".split(/ /));l.extend(l.fn,p.fn)}(jQuery,window,document);
